---
title: 后端学习笔记
date: 2023-03-30 00:00:01
cover: https://cdnjson.com/images/2023/05/13/photo-1648795639584-218305891ed6.png
tags: [JavaScript]
---
## 数据库
### 关系型与非关系型数据库
关系型数据库与非关系型数据库的区别
1. 关系型数据库
特点:
(1) sql语句增删改查操作
(2) 保持事务的一致性,事物机制（回滚)
mysql, sqlserver, db2, oracle
2. 非关系型数据库
特点:
(1) no sql: not only sql;
(2)轻量，高效自由。
mongodb, Hbase, Redis

### 为啥喜欢 MongoDB？
由于 MongoDB 独特的数据处理方式，可以将热点数据加载到内存，故而对查询来讲，会非常快（当然也会非常消耗内存);
同时由于采用了 BSON（二进制的 JSON）的方式存储数据，
故而对 JSON 格式数据具有非常好的支持性以及友好的表结构修改性，文档式的存储方式，数据友好可见;
数据库的分片集群负载具有非常好的扩展性以及非常不错的自动故障转移。

### SQL和MongoDB术语对比
SQL	                   MongoDB                         说明
表(Table)	           集合(Collection)                 数据库表/集合
行(Row)	               文档(Document)                   数据记录行/文档
列(Col)	               字段(Field)                      数据字段/域
主键(Primay Key)	   对象ID(ObjectId)                 主键，MongoDB 自动将 _id 字段设置为主键
索引(Index)	           索引(Index)                      索引
嵌套表(Embeded Table)  嵌入式文档(Embeded Document)
table joins                                            表连接，MongoDB 不支持

### node.js操作MongoDB流程
1. 配置 mongoose，连接数据库
2. 配置各个类的模型（写法类似 TS 接口），以便复用
3. 写接口

### 接口规范
RESTful 架构
简单来说就是 url 地址中只包含名词表示资源，使用 http 动词表示动作进行操作资源
举个例子：左边是错误的设计，而右边是正确的
```
GET /blog/getArticles --> GET /blog/Articles 获取所有文章
GET /blog/addArticles --> POST /blog/Articles 添加一篇文章
GET /blog/editArticles --> PUT /blog/Articles 修改一篇文章
GET /rest/api/deleteArticles?id=1 --> DELETE /blog/Articles/1 删除一篇文章

```

### 业务分层
* controll 层处理业务逻辑，调用 services 层
* services 层操作数据库
* model 层为数据库模型，数据库操作基于 model 层，

### 后端如何进行登陆鉴权
1. cookie & session：用 express-session 模块生成 session，session 是自动匹配 cookie 生成的对象。可以设置中间件进行 session 过期校验
2. JSON Web Token（JWT）
* 为什么用 Token？
因为 session 占空间，cookie 容易被跨站请求伪造，token 加上了只在后端保存的秘钥，比较安全
* JWT 鉴权登录过程中前后端都做了什么？
前端用 axios 拦截器处理，后端用中间件处理
前端每次请求前要带 Token，除了 login 页面。每次请求成功都存 Token（在 axios 拦截器中做，每次发请求时把 Token 带给后端，请求成功后再存一次最新的 Token，失败时根据情况重定向页面）。后端在接收到请求的时候判断是否有 Token，有则是相关请求，需要重新计算 Token 生成时间并生成新的 Token 返回，此时 Token 如果失效，返回 401。

### 前端路由和后端路由的区别
前端路由：
前端路由是在客户端（通常是浏览器）中处理的路由。在传统的 Web 应用程序中，当用户点击链接或提交表单时，浏览器会向服务器发送一个 HTTP 请求，服务器响应并返回一个新的 HTML 页面。这种方式被称为后端路由。但是，现代的前端开发中，常常使用单页应用（SPA）的架构，其中页面不会刷新，而是通过 JavaScript 在客户端进行路由切换和视图更新。前端路由器会根据 URL 的变化，将其映射到相应的组件或视图，然后在页面上动态加载和显示内容，而无需重新加载整个页面。

前端路由的特点：

在客户端进行处理，不需要向服务器发送额外的请求。
路由切换快速，因为只需要加载并更新页面的一部分。
可以实现动态路由和视图，根据 URL 的变化加载不同的组件或页面内容。
前端路由器通常使用浏览器的历史记录 API 来处理路由状态和导航。
后端路由：
后端路由是在服务器端处理的路由。在传统的 Web 应用程序中，后端服务器接收到客户端发送的请求后，根据请求的路径（URL）和其他参数，确定应该执行的代码逻辑或返回的数据。后端路由通常由服务器端框架（如Express.js、Django等）处理，并根据请求的路径将其映射到相应的处理程序或控制器函数。服务器处理后端路由时，可能会执行数据库查询、验证用户身份、处理业务逻辑等操作，最后将结果返回给客户端。

后端路由的特点：

在服务器端进行处理，通常需要向服务器发送请求，服务器响应返回结果。
可以执行复杂的服务器端逻辑，如数据库查询、身份验证、权限控制等。
返回的结果通常是动态生成的 HTML 页面、JSON 数据或其他格式的数据。
后端路由通常使用正则表达式或路由配置来定义和处理不同的路由。
综上所述，前端路由和后端路由在功能和处理位置上存在明显的区别。前端路由处理客户端的路由切换和视图更新，无需向服务器发送额外请求；后端路由处理服务器端的请求，执行复杂的逻辑并返回结果给客户端。

### koa和express的返回有什么区别
一个用 ctx.body= 返回，一个用 res.send() 或 res.render()

### 前后端登录流程
用户输入用户名，密码，验证码等，点击登录按钮就去请求登录的接口。
后端服务器判断用户账号密码正确之后，根据用户 id、用户名、定义好的秘钥、过期时间生成 token，返回给客户端浏览器。
后端接口判断请求头有无 token，没有或者 token 过期，返回 401。
前端拿到后端返回的 token，存储在 localStorage 里。
前端每次路由跳转，判断 localStorage 有无 token，没有则跳转到登录页，有则请求获取用户信息，改变登录状态。
每次请求接口，在 Axios 请求头里携带 token。
前端得到 401 状态码，重定向到登录页面



